<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
  <title>Wedding of Elaine & Filipe</title>
  <link rel="stylesheet" href="globals.css">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      scroll-snap-type: y mandatory;
      overflow-y: scroll;
      height: 100vh;
    }
    section {
      scroll-snap-align: start;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      position: relative;
    }
    .section-title {
      font-size: 3rem;
      color: #c2185b;
      margin-bottom: 1rem;
    }
    .horizontal-flex {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 2rem;
      flex-wrap: wrap;
    }
    .image-wheel img {
      width: 250px;
      height: 350px;
      object-fit: cover;
      border-radius: 1rem;
    }
    .text-card, .donation-board, .invitation-card {
      background-color: rgba(255, 255, 255, 0.85);
      padding: 1.5rem;
      border-radius: 1rem;
      max-width: 600px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    .qr-section img {
      width: 250px;
      height: 250px;
    }
    .countdown-bar {
      font-size: 2.5rem;
      color: #4a148c;
      margin-bottom: 2rem;
      text-align: center;
    }
    @media (max-width: 768px) {
      .horizontal-flex {
        flex-direction: column;
      }
      .image-wheel img, .qr-section img {
        width: 90%;
        height: auto;
      }
    }
  </style>
</head>

<body>

<style>
  :root {
    --section1-hue: 0deg;
    --section1-brightness: 100%;
    --section1-saturate: 100%;
    --section1-contrast: 100%;

    --section2-hue: 0deg;
    --section2-brightness: 100%;
    --section2-saturate: 100%;
    --section2-contrast: 100%;
  
    --section3-hue: 0deg;
    --section3-brightness: 120%;
    --section3-saturate: 100%;
    --section3-contrast: 80%;
  }

  .background-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    filter: blur(var(--section-blur, 5px))
            hue-rotate(var(--section-hue, 0deg))
            brightness(var(--section-brightness, 100%))
            saturate(var(--section-saturate, 100%))
            contrast(var(--section-contrast, 100%));
    z-index: 0;
  }

  #our-story > *:not(.background-layer) {
    position: relative;
    z-index: 1;
  }

#donations > *:not(.background-layer) {
  position: relative;
  z-index: 1;
}
#invitation > *:not(.background-layer) {
  position: relative;
  z-index: 1;
}
  .section-fade::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 120px;
  background: linear-gradient(to bottom, rgba(251,242,226,0) 0%, rgba(251,242,226,1) 100%);
  pointer-events: none;
  z-index: 2;
}

</style>

<section id="our-story" class="section-fade" style="
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2rem;
  --section-hue: var(--section1-hue);
  --section-brightness: var(--section1-brightness);
  --section-saturate: var(--section1-saturate);
  --section-contrast: var(--section1-contrast);
">
  <div class="background-layer" style="background-image: url('assets/images/BackgroundSec1.png');"></div>

  <!-- Título fora do cartão rosa -->
  <h1 class="section-title" style="text-align:center;">Our Story</h1>

  <div class="horizontal-flex" style="align-items:flex-start;">

    <!-- Pink Card Carousel with flores2.png background -->
    <div style="
      background-image: url('assets/images/flores2.png');
      background-size: cover;
      background-position: center;
      border-radius: 60px;
      padding: 30px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      width: 600px;
      min-width: 300px;
      position: relative;
    ">
      <div id="carousel-container" style="
        position: relative;
        width: 100%;
        height: 400px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      ">
        <!-- Left Image -->
        <img id="left-img" style="
          position: absolute;
          width: 150px;
          height: 150px;
          top: 125px;
          left: 20px;
          filter: blur(6px) brightness(70%) drop-shadow(0 20px 10px rgba(0,0,0,0.5));
          border-radius: 30px;
          transition: all 0.5s;
          z-index: 1;
        ">

        <!-- Right Image -->
        <img id="right-img" style="
          position: absolute;
          width: 150px;
          height: 150px;
          top: 125px;
          right: 20px;
          filter: blur(6px) brightness(70%) drop-shadow(0 20px 10px rgba(0,0,0,0.5));
          border-radius: 30px;
          transition: all 0.5s;
          z-index: 1;
        ">

        <!-- Center Image -->
        <img id="center-img" style="
          position: relative;
          width: 300px;
          height: 300px;
          filter: drop-shadow(0 31px 10px rgba(0,0,0,0.5));
          border-radius: 30px;
          transition: all 0.5s ease;
          z-index: 2;
        ">

        <!-- Navigation Buttons -->
        <button onclick="prevImage()" style="
          position: absolute;
          left: 10px;
          top: 50%;
          transform: translateY(-50%);
          background: rgba(255,255,255,0.8);
          border-radius: 10px;
          border: none;
          padding: 10px;
          cursor: pointer;
          z-index: 3;
        ">❮</button>

        <button onclick="nextImage()" style="
          position: absolute;
          right: 10px;
          top: 50%;
          transform: translateY(-50%);
          background: rgba(255,255,255,0.8);
          border-radius: 10px;
          border: none;
          padding: 10px;
          cursor: pointer;
          z-index: 3;
        ">❯</button>
      </div>
    </div>

    <!-- Text Card (Right) -->
    <div class="text-card" style="
      max-width:600px;
      width:600px;
      padding:1.5rem;
      border-radius:1rem;
      box-shadow:0 4px 20px rgba(0,0,0,0.2);
      background-size: cover;
      background-position: center;
      font-family: 'Dancing Script', cursive;
      font-size: 1.6rem;
      line-height: 2.2rem;
      color: #C2185B;
      background-repeat: no-repeat;
      background-attachment: local;
      padding-left: 20px;
      padding-right: 20px;
      background-image: 
        repeating-linear-gradient(
          to bottom,
          transparent,
          transparent 1.8rem,
          rgba(194, 24, 91, 0.2) 1.9rem,
          transparent 2rem
        ),
        url('assets/images/offwhite_paper_background.png');
    ">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. In id odio dolor. Etiam auctor, urna pretium pulvinar porta, odio lectus imperdiet arcu...</p>
    </div>
  </div>

</section>




<style>
  @media (max-width: 768px) {
    #our-story .horizontal-flex {
      flex-direction: column;
      align-items: center;
    }
    #carousel-container {
      height: auto !important;
    }
    #center-img {
      width: 90% !important;
      height: auto !important;
    }
    #left-img, #right-img {
      display: none;
    }
  }
</style>

<script>
  const images = ["PH1.jpg", "PH2.jpg", "PH3.jpg", "PH4.jpg"];
  let index = 0;
  let autoPlayInterval = null;

  function updateCarousel() {
    const left = document.getElementById("left-img");
    const center = document.getElementById("center-img");
    const right = document.getElementById("right-img");

    // Adiciona animação de fade/zoom
    center.style.opacity = "0";
    center.style.transform = "scale(0.95)";
    setTimeout(() => {
      left.src = "assets/images/" + images[(index - 1 + images.length) % images.length];
      center.src = "assets/images/" + images[index];
      right.src = "assets/images/" + images[(index + 1) % images.length];

      center.style.opacity = "1";
      center.style.transform = "scale(1)";
    }, 150);  // Pequeno atraso para dar o efeito
  }

  function nextImage() {
    index = (index + 1) % images.length;
    updateCarousel();
  }

  function prevImage() {
    index = (index - 1 + images.length) % images.length;
    updateCarousel();
  }

  function startAutoPlay() {
    autoPlayInterval = setInterval(nextImage, 4000);  // Troca a cada 4 segundos
  }

  function stopAutoPlay() {
    clearInterval(autoPlayInterval);
  }

document.addEventListener('click', () => playAudioFor("our-story"), { once: true });
document.addEventListener('touchstart', () => playAudioFor("our-story"), { once: true });

</script>

  <!-- Section 2: Thank You and Donations -->
<section id="donations" class="section-fade" style="
  position: relative;
  overflow: hidden;
  --section-hue: var(--section2-hue);
  --section-brightness: var(--section2-brightness);
  --section-saturate: var(--section2-saturate);
  --section-contrast: var(--section2-contrast);
">
 <div class="background-layer" style="background-image: url('assets/images/BackgroundSec2.png');"></div>

  <div style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 120px;
    background: linear-gradient(to top, rgba(251,242,226,0) 0%, rgba(251,242,226,1) 100%);
    pointer-events: none;
    z-index: 2;
  "></div>

    <h1 class="section-title">Faça parte com sua ajuda</h1>
    <div class="horizontal-flex">
      <div class="donation-board">
        <a href="https://paypal.com/example" target="_blank">Help with our honeymoon - PayPal</a><br>
        <a href="https://picpay.me/example" target="_blank">Contribute via PicPay</a><br>
        <a href="https://example.com" target="_blank">Gift Registry</a>
      </div>
      <div class="qr-section">
        <img src="assets/images/QRCode.png" alt="Donation QR Code">
        <p>Toda ajuda é recebida com amor ❤️</p>
      </div>
    </div>
  </section>

  <!-- Section 3: Invites and Guest Norms -->
<section id="donations" class="section-fade" style="
  position: relative;
  overflow: hidden;
  --section-hue: var(--section2-hue);
  --section-brightness: var(--section2-brightness);
  --section-saturate: var(--section2-saturate);
  --section-contrast: var(--section2-contrast);
">
<div class="background-layer" style="
  background-image: url('assets/images/Maison.jpg');
  filter: 
    blur(2px)
    hue-rotate(var(--section3-hue))
    brightness(var(--section3-brightness))
    saturate(var(--section3-saturate))
    contrast(var(--section3-contrast));
"></div>
  <div style="
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 20px;
    background: linear-gradient(to top, rgba(0,0,0,0) 0%, rgba(251,242,226,1) 100%);
    pointer-events: none;
    z-index: 2;
  "></div>
    <h1 class="section-title">Orientações e Informações</h1>

    <!-- Countdown comes first -->
    <div class="countdown-bar" id="countdown">
      Faltam só <span id="days">0</span> dias <span id="hours">0</span> horas!!!
    </div>

    <div class="invitation-card">
      <h2 style="text-align: center;"><a href="https://www.instagram.com/maisongarden_" target="_blank">Maison Garden</a></h2>
      <p>Data: 27/12/2025</p>
      <p>Localização: Praça Inácio do Canto, nº 9, Madureira, Rio de Janeiro</p>
      <p>Horário: 16:00h</p>
      <p>Dress code: Vide Ingresso</p>
      <a href="https://forms.gle/RSVPFormExample" target="_blank">Confirme sua presença AQUI</a>
    </div>
  </section>

<!-- Background Music -->
<audio id="story-audio" src="assets/audio/A_Thousand_Years.mp3" preload="auto" loop></audio>
<audio id="donation-audio" src="assets/audio/Marry_Me_Bella.mp3" preload="auto" loop></audio>
<audio id="invites-audio" src="assets/audio/Turning_Page.mp3" preload="auto" loop></audio>

<script>
  // Countdown Timer
  const weddingDate = new Date("2025-12-27T16:00:00").getTime();
  function updateCountdown() {
    const now = new Date().getTime();
    const distance = weddingDate - now;
    if (distance <= 0) {
      document.getElementById("countdown").innerHTML = "It's wedding time!";
      return;
    }
    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);
    document.getElementById("days").innerText = days;
    document.getElementById("hours").innerText = hours;
    document.getElementById("minutes").innerText = minutes;
    document.getElementById("seconds").innerText = seconds;
  }
  setInterval(updateCountdown, 1000);
  updateCountdown();

  // Section-based Audio Control
  const audios = {
    "our-story": document.getElementById('story-audio'),
    "donations": document.getElementById('donation-audio'),
    "invites": document.getElementById('invites-audio')
  };

  const audioReady = {};
  let pendingSectionToPlay = null;
  let currentPlayingSection = "";
  let debounceTimeout = null;

  const sections = document.querySelectorAll("section");

  function fadeOut(audio, duration = 1000) {
    let step = audio.volume / (duration / 50);
    let fade = setInterval(() => {
      if (audio.volume > step) {
        audio.volume -= step;
      } else {
        audio.volume = 0;
        audio.pause();
        clearInterval(fade);
      }
    }, 50);
  }

  function fadeIn(audio, duration = 1000) {
    audio.muted = false;
    audio.volume = 0;
    let playPromise = audio.play();
    if (playPromise !== undefined) {
      playPromise.catch(() => {});
    }
    let step = 1 / (duration / 50);
    let fade = setInterval(() => {
      if (audio.volume < 1 - step) {
        audio.volume += step;
      } else {
        audio.volume = 1;
        clearInterval(fade);
      }
    }, 50);
  }

  // Attach canplaythrough handlers ONCE, up front
  Object.keys(audios).forEach(sectionId => {
    audios[sectionId].addEventListener('canplaythrough', () => {
      audioReady[sectionId] = true;
      // Only fade in if this is *still* the section the user wants, AND is still the actual visible section
      if (
        pendingSectionToPlay === sectionId &&
        isSectionActive(sectionId)
      ) {
        fadeIn(audios[sectionId]);
        currentPlayingSection = sectionId;
        pendingSectionToPlay = null;
      }
    });
  });

  function isSectionActive(sectionId) {
    // Checks if the given section is actually centered
    const section = document.getElementById(sectionId);
    if (!section) return false;
    const rect = section.getBoundingClientRect();
    return (
      rect.top <= window.innerHeight / 2 &&
      rect.bottom >= window.innerHeight / 2
    );
  }

  function playAudioFor(sectionId) {
    if (sectionId === currentPlayingSection) return;
    pendingSectionToPlay = sectionId;

    // Fade out current audio
    if (currentPlayingSection && audios[currentPlayingSection]) {
      fadeOut(audios[currentPlayingSection]);
    }

    const newAudio = audios[sectionId];
    if (newAudio) {
      if (audioReady[sectionId] && isSectionActive(sectionId)) {
        fadeIn(newAudio);
        currentPlayingSection = sectionId;
        pendingSectionToPlay = null;
      }
      // Else: will be handled by canplaythrough + active check above
    }
  }

  document.addEventListener("scroll", () => {
    let activeSection = "";
    sections.forEach(section => {
      const rect = section.getBoundingClientRect();
      if (rect.top <= window.innerHeight / 2 && rect.bottom >= window.innerHeight / 2) {
        activeSection = section.id;
      }
    });

    if (activeSection && activeSection !== currentPlayingSection) {
      if (debounceTimeout) clearTimeout(debounceTimeout);
      debounceTimeout = setTimeout(() => {
        playAudioFor(activeSection);
      }, 800);
    }
  });

  window.onload = function() {
    updateCarousel();
    startAutoPlay();
    currentPlayingSection = "our-story";

    if (audioReady["our-story"]) {
      fadeIn(audios["our-story"]);
    } else {
      audios["our-story"].addEventListener('canplaythrough', () => fadeIn(audios["our-story"]), { once: true });
    }
  };

  // Browser autoplay fallback: First user click or tap
  document.addEventListener('click', () => {
    const firstAudio = audios[currentPlayingSection];
    if (firstAudio && firstAudio.paused) {
      fadeIn(firstAudio);
    }
  }, { once: true });

  document.addEventListener('touchstart', () => {
    const firstAudio = audios[currentPlayingSection];
    if (firstAudio && firstAudio.paused) {
      fadeIn(firstAudio);
    }
  }, { once: true });

</script>



</body>
</html>
