<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=4.0">
  <title>Wedding of Elaine & Filipe</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="globals.css">
  <link rel="stylesheet" href="style.css">
  <style>
    :root {
      --dark-main: #3B2752;
      --light-main: #FBF2E2;
      --accent: #C2185B;
    }
    html, body {
      background: var(--light-main);
      color: var(--dark-main);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-y: scroll;
      scroll-behavior: smooth;
      scroll-snap-type: y proximity;
    }

    html {
      scroll-padding: 10px 0;
    }

    section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem 2rem;
      position: relative;
      height: 100vh;
      scroll-snap-align: center;
      scroll-snap-stop: normal;
      overflow: hidden;
    }

    /* Overlay styling - FIXED POSITIONING FOR FULL VIEWPORT COVERAGE */
    .section-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(251, 242, 226, 0.98);
      z-index: 1000;
      display: none;
      overflow-y: auto;
      padding: 2rem;
    }

    .section-overlay.active {
      display: block;
      animation: fadeIn 0.4s ease-out;
    }

    @keyframes overlayFadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .overlay-content {
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
      position: relative;
      padding: 3rem 2rem;
      min-height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    .overlay-close {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 2rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(194, 24, 91, 0.4);
      transition: all 0.3s ease;
      z-index: 1001;
      display: flex;
      align-items: center;
      justify-content: center;
      line-height: 1;
    }

    .overlay-close:hover {
      background: #99204a;
      transform: scale(1.15);
      box-shadow: 0 6px 20px rgba(194, 24, 91, 0.6);
    }

    /* Add CSS scroll snap points for gentle pull */
    @media (prefers-reduced-motion: no-preference) {
      html {
        scroll-snap-type: y proximity;
      }
    }

    /* Smooth scroll timing */
    * {
      scroll-behavior: smooth;
    }

    @supports (scroll-timeline: --section-scroll) {
      html {
        scroll-timeline: --section-scroll;
        animation-timeline: --section-scroll;
      }
    }

    .section-title {
      font-family: 'Dancing Script', cursive;
      color: var(--accent);
      font-size: 3.5rem;
      margin-bottom: 1.5rem;
      letter-spacing: 1px;
      text-align: center;
      animation: scaleIn 1s ease-out;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      opacity: 1 !important;
    }

    /* Ensure all text has full opacity */
    h1, h2, h3, h4, h5, h6, p, span, div {
      opacity: 1;
    }
    h2, h3 {
      font-family: 'Dancing Script', cursive;
      color: var(--accent);
      margin-top: 0.5em;
      margin-bottom: 0.5em;
    }
    p, span, li, label {
      color: var(--dark-main);
      font-size: 1.12rem;
      font-family: 'Segoe UI', Arial, sans-serif;
      line-height: 1.7;
      margin-bottom: 0.6em;
    }
    /* Keyframe Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes fadeInNames {
      0% {
        opacity: 0;
        transform: translateY(-30px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes backgroundPanUp {
      0% {
        opacity: 0;
        transform: translateY(30px) scale(1.05);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    @keyframes coupleNamesDrop {
      0% {
        opacity: 0;
        transform: translateY(-50px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideNames {
      0% {
        opacity: 0;
        letter-spacing: 20px;
      }
      100% {
        opacity: 1;
        letter-spacing: 5px;
      }
    }

    .couple-names {
      font-family: 'Dancing Script', cursive;
      font-size: 9rem;
      color: var(--accent);
      text-align: center;
      margin-bottom: 2rem;
      animation: coupleNamesDrop 1.2s ease-out 0.8s both;
      text-shadow:
        0 4px 8px rgba(0,0,0,0.3),
        0 8px 16px rgba(0,0,0,0.25),
        0 12px 24px rgba(0,0,0,0.2),
        2px 2px 4px rgba(0,0,0,0.4);
      font-weight: 700;
      position: relative;
      z-index: 10;
      line-height: 1.1;
    }

    .couple-names .name-separator {
      font-size: 6rem;
      margin: 0 1rem;
      animation: scaleIn 1.2s ease-out 1s both;
    }

    /* Carousel center image hover effect - smooth and gradual */
    #carousel-container {
      transition: gap 0.6s ease;
    }

    .carousel-center {
      transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
    }

    .carousel-center:hover {
      height: 90vh !important;
      width: auto !important;
      transform: scale(1.02);
      box-shadow: 0 25px 70px rgba(0,0,0,0.6) !important;
      z-index: 10 !important;
    }

    /* Smooth side image movement when center is hovered */
    #carousel-container:has(.carousel-center:hover) #left-img,
    #carousel-container:has(.carousel-center:hover) #right-img {
      transform: translateX(0);
      transition: all 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    @keyframes typewriter {
      from {
        width: 0;
      }
      to {
        width: 100%;
      }
    }

    @keyframes fadeInLetter {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Fullscreen Carousel Modal */
    #carousel-fullscreen-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-out;
    }

    #carousel-fullscreen-modal.active {
      display: flex;
    }

    #fullscreen-carousel-img {
      max-width: 90vw;
      max-height: 90vh;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8);
      animation: scaleIn 0.4s ease-out;
    }

    #close-fullscreen {
      position: absolute;
      top: 30px;
      right: 30px;
      background: rgba(255,255,255,0.9);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 2rem;
      cursor: pointer;
      color: var(--dark-main);
      transition: all 0.3s ease;
      z-index: 10000;
    }

    #close-fullscreen:hover {
      background: white;
      transform: rotate(90deg);
    }

    /* Audio Permission Bubble */
    #audio-permission {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: rgba(255,255,255,0.98);
      padding: 1.5rem 2rem;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(59,39,82,0.3);
      z-index: 10000;
      display: none;
      animation: slideInUp 0.5s ease-out;
      border: 2px solid var(--accent);
    }

    #audio-permission.active {
      display: block;
    }

    @keyframes slideInUp {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    #audio-permission h3 {
      margin: 0 0 1rem 0;
      color: var(--accent);
      font-size: 1.4rem;
    }

    #audio-permission p {
      margin: 0 0 1.2rem 0;
      color: var(--dark-main);
      font-size: 1.1rem;
    }

    .audio-controls {
      display: flex;
      gap: 1rem;
    }

    .audio-btn {
      padding: 0.7rem 1.5rem;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .audio-btn.allow {
      background: var(--accent);
      color: white;
    }

    .audio-btn.allow:hover {
      background: #99204a;
      transform: translateY(-2px);
    }

    .audio-btn.mute {
      background: #e0e0e0;
      color: var(--dark-main);
    }

    .audio-btn.mute:hover {
      background: #d0d0d0;
    }

    .love-letter {
      position: relative;
      background-image: url('assets/images/Paper.jpg');
      background-size: cover;
      background-position: center;
      border-radius: 10px;
      padding: 4rem 5rem 4rem 8rem;
      max-width: 1400px;
      width: 92%;
      margin: 2rem auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      position: relative;
      animation: fadeInUp 1s ease-out;
    }

    .love-letter::before {
      content: '';
      position: absolute;
      top: 0;
      left: 100px;
      width: 3px;
      height: 100%;
      background: rgba(194,24,91,0.2);
    }

    .love-letter p {
      font-family: 'Dancing Script', cursive;
      font-size: 2.3rem;
      line-height: 3.2rem;
      color: #0d0a08;
      margin: 0 0 2.5rem 0;
      padding-left: 0;
      text-align: left;
      position: relative;
      animation: fadeInLetter 1.5s ease-out;
      text-shadow: 0.5px 0.5px 0.5px rgba(0,0,0,0.1);
      font-weight: 500;
    }

    .love-letter-signature {
      font-family: 'Dancing Script', cursive;
      font-size: 2.8rem;
      text-align: right;
      margin-top: 4rem;
      color: var(--accent);
      font-weight: 700;
      text-shadow: 0.5px 0.5px 1px rgba(0,0,0,0.2);
    }

    /* Unified Card Styles - Larger and More Beautiful */
    .card, .donation-board, .invitation-card, .text-card, .countdown-card {
      background: rgba(255,255,255,0.94);
      backdrop-filter: blur(8px);
      border-radius: 1.5rem;
      box-shadow: 0 6px 24px rgba(59,39,82,0.12);
      border: 2px solid #f7e6ee;
      padding: 2.2rem 2rem;
      margin: 1.5rem 0;
      max-width: 800px;
      width: 90%;
      color: var(--dark-main);
      font-size: 1.15rem;
      font-family: 'Segoe UI', Arial, sans-serif;
      animation: fadeInUp 0.8s ease-out;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover, .donation-board:hover, .invitation-card:hover, .text-card:hover {
      transform: translateY(-5px) scale(1.01);
      box-shadow: 0 12px 40px rgba(59,39,82,0.22);
    }

    .card, .donation-board, .invitation-card, .text-card {
      will-change: transform, box-shadow;
    }
    .countdown-card {
      text-align: center;
      font-size: 2.5rem;
      font-weight: 600;
      color: var(--accent);
      padding: 2rem 2.5rem;
      letter-spacing: 0.1px;
      border-radius: 1.6rem;
      box-shadow: 0 8px 28px rgba(59,39,82,0.18);
      border: 2px solid #f7e6ee;
      margin-bottom: 2.5rem;
      max-width: 900px;
      animation: scaleIn 1.2s ease-out;
      transition: transform 0.3s ease;
    }
    .countdown-card:hover {
      transform: scale(1.02);
    }
    .countdown-card .countdown-value {
      color: var(--accent);
      font-size: 3rem;
      font-weight: 700;
      margin: 0 0.3em;
    }
    .countdown-card .countdown-label {
      color: var(--dark-main);
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0 0.25em;
    }
    /* Donations section new flex and board */
    .donations-flexrow {
      display: flex;
      flex-direction: row;
      align-items: flex-start;
      gap: 2.5rem;
      width: 100%;
      justify-content: center;
    }
    .donations-stack {
      display: flex;
      flex-direction: column;
      gap: 1.4rem;
    }
    #donations .donation-board {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-width: 360px;
      max-width: 450px;
      width: 100%;
      background: rgba(255,255,255,0.95);
      border-radius: 1.5rem;
      box-shadow: 0 6px 24px rgba(59,39,82,0.12);
      border: 2px solid #f7e6ee;
      padding: 2.8rem 2rem 2rem 2rem;
      margin: 1rem 0;
      box-sizing: border-box;
      animation: fadeInUp 1s ease-out;
    }
    #donations .donation-board img.icon {
      width: 110px;
      height: 110px;
      margin-bottom: 1.5rem;
      transition: transform 0.3s ease;
    }
    #donations .donation-board:hover img.icon {
      transform: scale(1.1) rotate(5deg);
    }
    #donations .donation-board .donation-title {
      font-size: 1.35rem;
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 0.7em;
      text-align: center;
    }
    #donations .donation-board .donation-btn {
      width: 90%;
      max-width: 220px;
      margin-top: 1em;
      text-align: center;
      font-size: 1.1rem;
      padding: 0.5em 1.5em;
    }
    #donations .donation-board.qr {
      padding: 2.8rem 2rem 2.5rem 2rem;
    }
    #donations .donation-board.qr img.qr {
      width: 300px;
      height: 310px;
      margin: 1.5rem 0 0 0;
      border-radius: 1.2rem;
      border: 3px solid #f7e6ee;
      background: #fff;
      transition: transform 0.3s ease;
    }
    #donations .donation-board.qr:hover img.qr {
      transform: scale(1.05);
    }
    #donations .donation-board.qr .donation-title {
      color: var(--accent);
      font-size: 1.25rem;
      font-weight: 500;
      margin-bottom: 0.3rem;
    }
    .donation-qr-with-margin {
      /* Default no extra margin on desktop */
      margin-bottom: 0;
    }
    /* Comprehensive Mobile Responsiveness */
    @media (max-width: 900px) {
      .section-title {
        font-size: 2.8rem;
      }
      .couple-names {
        font-size: 5rem;
      }
      .couple-names .name-separator {
        font-size: 3.5rem;
      }
      .donations-flexrow {
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
      }
      .donation-qr-with-margin {
        margin-bottom: 2.2rem;
      }
      #donations .donation-board {
        width: 90vw !important;
        max-width: 500px !important;
        min-width: unset !important;
      }
      .card, .donation-board, .invitation-card, .text-card, .countdown-card {
        width: 90vw;
        max-width: 500px;
        padding: 1.8rem 1.5rem;
      }
      .countdown-card {
        font-size: 1.8rem;
        padding: 1.5rem 1.2rem;
      }
      .countdown-card .countdown-value {
        font-size: 2.2rem;
      }
      .countdown-card .countdown-label {
        font-size: 1.1rem;
      }
      .horizontal-flex {
        flex-direction: column !important;
        align-items: center !important;
      }
    }

    @media (max-width: 768px) {
      .section-title {
        font-size: 2.5rem;
      }
      .couple-names {
        font-size: 3rem;
      }
      .couple-names .name-separator {
        font-size: 2.2rem;
      }
      /* Carousel adjustments for mobile - larger size */
      div[style*="width: 900px"] {
        width: 95vw !important;
        max-width: 550px !important;
        padding: 30px !important;
      }
      #carousel-container {
        height: 55vh !important;
        gap: 1rem !important;
      }
      #center-img {
        width: 320px !important;
        height: 500px !important;
      }
      #left-img, #right-img {
        width: 180px !important;
        height: 300px !important;
      }
      .love-letter {
        padding: 3rem 2rem 3rem 5rem !important;
        width: 85% !important;
        max-width: 600px !important;
      }
      .love-letter::before {
        left: 50px !important;
      }
      .love-letter p {
        font-size: 1.8rem !important;
        line-height: 2.6rem !important;
        margin-bottom: 2rem !important;
      }
      .love-letter-signature {
        font-size: 2.3rem !important;
        margin-top: 3rem !important;
      }
      #donations .donation-board img.icon {
        width: 90px;
        height: 90px;
      }
      #donations .donation-board.qr img.qr {
        width: 260px;
        height: 270px;
      }
    }

    @media (max-width: 480px) {
      .section-title {
        font-size: 2.2rem;
      }
      .couple-names {
        font-size: 3rem;
      }
      .couple-names .name-separator {
        font-size: 2.2rem;
        margin: 0 0.5rem;
      }
      .countdown-card {
        font-size: 1.5rem;
        flex-wrap: wrap;
      }
      .countdown-card .countdown-value {
        font-size: 1.9rem;
      }
      .countdown-card .countdown-label {
        font-size: 1rem;
      }
      #carousel-container {
        height: 50vh !important;
        gap: 0.8rem !important;
      }
      #center-img {
        width: 260px !important;
        height: 400px !important;
      }
      #left-img, #right-img {
        width: 140px !important;
        height: 230px !important;
      }
      .love-letter {
        padding: 2.5rem 1.5rem 2.5rem 4rem !important;
        width: 80% !important;
      }
      .love-letter::before {
        left: 50px !important;
        width: 2px !important;
      }
      .love-letter p {
        font-size: 1.7rem !important;
        line-height: 2.4rem !important;
        margin-bottom: 1.8rem !important;
      }
      .love-letter-signature {
        font-size: 2.1rem !important;
        margin-top: 2.5rem !important;
      }
      #donations .donation-board.qr img.qr {
        width: 220px;
        height: 230px;
      }
    }
    /* Section backgrounds */
    .background-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      z-index: 1;
    }

    #title-section .background-layer {
      animation: backgroundPanUp 2s ease-out forwards;
      filter: brightness(0.7);
    }

    section > *:not(.background-layer) {
      position: relative;
      z-index: 2;
      opacity: 1 !important;
    }
    .section-fade::after {
      content: "";
      position: absolute;
      bottom: 0; left: 0; width: 100%; height: 120px;
      background: linear-gradient(to bottom, rgba(251,242,226,0) 0%, rgba(251,242,226,1) 100%);
      pointer-events: none;
      z-index: 2;
    }
    /* Buttons & Links */
    a, .btn {
      color: var(--light-main) !important;
      background: var(--accent);
      padding: 0.5em 1.5em;
      border-radius: 999px;
      text-decoration: none;
      font-weight: 600;
      display: inline-block;
      margin-top: 0.5em;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(194, 24, 91, 0.3);
    }
    a:hover, .btn:hover {
      background: #99204a;
      color: var(--light-main) !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(194, 24, 91, 0.4);
    }
    a:active, .btn:active {
      transform: translateY(0);
    }
    /* Scrollbar */
    ::-webkit-scrollbar { width: 10px; background: #f1e6f5; }
    ::-webkit-scrollbar-thumb { background: #c5a5c9; border-radius: 8px; }
  </style>
</head>
<body>

<!-- Fullscreen Carousel Modal -->
<div id="carousel-fullscreen-modal">
  <button id="close-fullscreen">Ã—</button>
  <img id="fullscreen-carousel-img" src="" alt="Fullscreen Image">
</div>

<!-- Audio Permission Bubble -->
<div id="audio-permission">
  <h3>ğŸµ MÃºsica de Fundo</h3>
  <p>Gostaria de ouvir mÃºsica enquanto navega?</p>
  <div class="audio-controls">
    <button class="audio-btn allow" onclick="allowAudio()">Sim, por favor!</button>
    <button class="audio-btn mute" onclick="muteAudio()">NÃ£o, obrigado</button>
  </div>
</div>

<!-- ========================================
     SECTION 1: TITLE SECTION
     ======================================== -->
<section id="title-section" class="section-fade">
  <div class="background-layer" style="background-image: url('assets/images/Title1.jpg');"></div>
  <h1 class="couple-names">Elaine <span class="name-separator">&</span> Filipe</h1>
</section>

<!-- ========================================
     SECTION 2: CAROUSEL (with Love Letter Overlay)
     ======================================== -->
<section id="carousel-section" class="section-fade">
  <div class="background-layer" style="background-image: url('assets/images/BackgroundSec1.png');"></div>
  <h1 class="section-title">Nossa HistÃ³ria</h1>
  <div id="carousel-container" style="position: relative; width: 100%; max-width: 1200px; height: 60vh; display: flex; justify-content: center; align-items: center; gap: 2rem; transition: all 0.6s ease;">
    <img id="left-img" style="width: 280px; height: 450px; object-fit: cover; object-position: center 20%; filter: blur(3px) brightness(75%); border-radius: 15px; transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
    <img id="center-img" class="carousel-center" style="width: 400px; height: 600px; object-fit: cover; object-position: center 20%; border-radius: 20px; cursor: pointer; box-shadow: 0 20px 50px rgba(0,0,0,0.4); z-index: 2;" onclick="openFullscreen()">
    <img id="right-img" style="width: 280px; height: 450px; object-fit: cover; object-position: center 20%; filter: blur(3px) brightness(75%); border-radius: 15px; transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
  </div>
  <button onclick="toggleLoveLetter()" class="btn" style="font-size: 1.2rem; padding: 0.8rem 2rem; margin-top: 2rem;">ğŸ“– Leia Nossa HistÃ³ria de Amor</button>
</section>

<!-- ========================================
     SECTION 3: DONATIONS
     ======================================== -->
<section id="donations" class="section-fade">
  <div class="background-layer" style="background-image: url('assets/images/BackgroundSec2.png');"></div>
  <h1 class="section-title" style="margin-bottom: 1.5rem;">FaÃ§a parte com sua ajuda â¤ï¸</h1>
  <div class="donations-flexrow">
    <div class="donations-stack">
      <!-- GIFT CARD -->
      <div class="donation-board">
        <img class="icon" src="assets/images/iconGifts.png" alt="Lista de Presentes">
        <a class="donation-btn" href="https://www.amazon.com.br/hz/wishlist/ls/1CWJZ7I2NHRFU?ref_=wl_share" target="_blank">Ver Lista de Presentes</a>
      </div>
      <!-- HONEYMOON CARD -->
      <div class="donation-board">
        <img class="icon" src="assets/images/iconResort.png" alt="Lua de Mel">
        <a class="donation-btn" href="https://www.agenciammtour.com.br/lua-de-mel-cotas/cota/nome/elaine-filipe" target="_blank">Presentear Lua de Mel</a>
      </div>
    </div>
    <!-- QR CODE CARD -->
    <div class="donation-board qr donation-qr-with-margin">
      <img class="icon" src="assets/images/iconMoney.png" alt="DoaÃ§Ã£o">
      <span class="donation-title">PIX para sua contribuiÃ§Ã£o direta.</span>
      <span class="donation-title" style="font-family:'Dancing Script',cursive;" >(Abra no aplicativo do seu banco)</span>
      <img class="qr" src="assets/images/QRCode.png" alt="Donation QR Code">
    </div>
  </div>
</section>

<!-- ========================================
     SECTION 4: VENUE INFO (with Dress Code Overlay)
     ======================================== -->
<section id="venue-info" class="section-fade">
  <div class="background-layer" style="background-image: url('assets/images/Maison.jpg'); filter: blur(2px);"></div>
  <h1 class="section-title">CerimÃ´nia e RecepÃ§Ã£o</h1>
  <!-- Countdown Card - Compact -->
  <div class="countdown-card" style="padding: 0.5rem 2rem; margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; gap: 1.2rem; flex-wrap: wrap;">
    <span class="countdown-label">Faltam</span>
    <span id="days" class="countdown-value">0</span><span class="countdown-label">Dias e</span>
    <span id="hours" class="countdown-value">0</span><span class="countdown-label">Horas</span>
    <a href="https://forms.gle/RSVPFormExample" target="_blank" class="donation-btn" style="margin: 0; padding: 0.8rem 1.8rem; font-size: 1.1rem;">Confirme sua presenÃ§a AQUI</a>
  </div>

  <!-- Unified Venue & Dress Code Card -->
  <div class="donation-board" style="max-width: 700px; width: 90%; padding: 2.5rem;">
    <!-- Venue Header with Arch Icons -->
    <div style="text-align: center; margin-bottom: 2rem;">
      <h2 style="margin: 0; font-size: 2.8rem; color: var(--accent); font-weight: 700; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">Local da CerimÃ´nia</h2>
      <div style="display: flex; align-items: center; justify-content: center; gap: 1.5rem; margin: 1rem 0;">
        <span style="font-size: 4rem;">ğŸ’’</span>
        <h3 style="margin: 0; font-size: 3.8rem; color: var(--accent); font-family: 'Dancing Script', cursive;">Maison Garden</h3>
        <span style="font-size: 4rem;">ğŸ’’</span>
      </div>
    </div>

    <!-- Google Maps Button -->
    <a class="donation-btn" href="https://www.google.com/maps?q=PraÃ§a+InÃ¡cio+do+Canto,+9,+Madureira,+Rio+de+Janeiro" target="_blank" style="display: block; text-align: center; margin-bottom: 2rem;">Veja no Google Maps</a>

    <!-- Event Details -->
    <div style="background: rgba(194,24,91,0.08); padding: 1.5rem; border-radius: 15px; margin-bottom: 2rem; text-align: center;">
      <p style="margin:0.6rem 0; font-size:1.1rem; color: var(--dark-main);"><b>ğŸ“…</b> 27 de Dezembro de 2025</p>
      <p style="margin:0.6rem 0; font-size:1.1rem; color: var(--dark-main);"><b>ğŸ“</b> PraÃ§a InÃ¡cio do Canto, nÂº 9, Madureira, Rio de Janeiro</p>
      <p style="margin:0.6rem 0; font-size:1.1rem; color: var(--dark-main);"><b>ğŸ‘”</b> CÃ³digo de Vestimenta:<span style="color: var(--accent); font-weight: 700;"> Esporte Fino</span> <b>ğŸ‘—</b></p>
      <p style="margin:0.6rem 0; font-size:1.1rem; color: var(--dark-main);"><b>ğŸ•“</b> 16:30 <span style="color: var(--accent); font-weight: 600;">(Chegue antes! â¤ï¸)</span></p>
    </div>

    <!-- Dress Code Button -->
    <a onclick="toggleDressCode()" class="donation-btn" href="#" style="display: block; text-align: center; margin-top: 2rem; cursor: pointer; text-decoration: none;">Veja InspiraÃ§Ãµes de VestuÃ¡rio</a>
  </div>
</section>

<!-- ========================================
     OVERLAYS (Fixed Position - Outside Sections)
     ======================================== -->

<!-- Love Letter Overlay -->
<div id="love-letter-overlay" class="section-overlay">
  <div class="overlay-content">
    <button class="overlay-close" onclick="toggleLoveLetter()">Ã—</button>
    <div class="love-letter" style="width: 100%; max-width: 900px;">
      <h1 class="section-title" style="margin-top: 2rem;">Nossa HistÃ³ria de Amor</h1>
      <p>Nos conhecemos na faculdade, o destino e os rolÃªs universitÃ¡rios nos apresentaram, mas foi sÃ³ quatro anos depois, que as coisas realmente comeÃ§aram.</p>
      <p>Nosso primeiro encontro? Cerveja quente num quiosque velho perto de uma praia. Pode nÃ£o parecer o mais romÃ¢ntico dos cenÃ¡rios, mas hoje a gente morre de rir ao lembrar porque foi ali que comeÃ§ou tudo.</p>
      <p>Desde entÃ£o, vivemos um relacionamento cheio de parceria e amor. A gente Ã© grudento mesmo e adora assistir filmes juntos, rir das nossas piadas internas (e das que ninguÃ©m mais entende) e aproveitar um barzinho sempre que dÃ¡. O amor aqui Ã© feito de cumplicidade, apoio e muitas risadas.</p>
      <p>Depois de 6 anos juntos, veio o pedido: no meio de um show da Mariah Carey! Uma grande surpresa que tornou um momento especial em um dos mais marcantes da nossa histÃ³ria. Mal podemos esperar pra viver o prÃ³ximo capÃ­tulo, de mÃ£os dadas. Agora, chegou a hora de celebrar tudo isso com quem a gente ama. E Ã© por isso que vocÃª estÃ¡ aqui, pra celebrar com a gente!</p>
      <div class="love-letter-signature">Com amor, Elaine & Filipe â¤ï¸</div>
    </div>
  </div>
</div>

<!-- Dress Code Overlay -->
<div id="dress-code-overlay" class="section-overlay">
  <div class="overlay-content">
    <button class="overlay-close" onclick="toggleDressCode()">Ã—</button>
    <div style="width: 100%; max-width: 1200px; padding: 2rem;">
      <h1 class="section-title" style="margin-top: 2rem;">Dress Code</h1>
      <h2 style="margin-top:0; margin-bottom:3rem; font-size:2.5rem; color: var(--accent); text-align: center;">ğŸ‘” Esporte Fino ğŸ‘—</h2>

      <!-- Dress Code Carousel Container -->
      <div id="dress-code-carousel" style="position: relative; width: 100%; max-width: 1000px; height: 60vh; display: flex; justify-content: center; align-items: stretch; gap: 3rem; transition: all 0.6s ease; margin: 0 auto;">
        <!-- Gentlemen Section -->
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 1.5rem;">
          <h3 style="font-size: 1.8rem; color: var(--accent); font-family: 'Dancing Script', cursive; margin: 0;">ğŸ‘” Cavalheiros</h3>
          <div style="flex: 1; width: 100%; overflow: hidden; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);">
            <img id="dress-men-img" src="assets/images/esporte-fino1.jpg" alt="Esporte Fino - Cavalheiros" onclick="openDressFullscreen('men')" style="width: 100%; height: 100%; object-fit: cover; object-position: center top; cursor: pointer; transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);">
          </div>
        </div>

        <!-- Ladies Section -->
        <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 1.5rem;">
          <h3 style="font-size: 1.8rem; color: var(--accent); font-family: 'Dancing Script', cursive; margin: 0;">ğŸ‘— Damas</h3>
          <div style="flex: 1; width: 100%; overflow: hidden; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);">
            <img id="dress-ladies-img" src="assets/images/ladies-esporte-fino1.jpg" alt="Esporte Fino - Damas" onclick="openDressFullscreen('ladies')" style="width: 100%; height: 100%; object-fit: cover; object-position: center top; cursor: pointer; transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Dress Code Fullscreen Modal -->
<div id="dress-fullscreen-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 2000; align-items: center; justify-content: center;">
  <button onclick="closeDressFullscreen()" style="position: fixed; top: 2rem; right: 2rem; background: var(--accent); color: white; border: none; width: 60px; height: 60px; border-radius: 50%; font-size: 2rem; cursor: pointer; z-index: 2001; display: flex; align-items: center; justify-content: center; line-height: 1;">Ã—</button>
  <img id="dress-fullscreen-img" src="" alt="Fullscreen" style="max-width: 90vw; max-height: 90vh; object-fit: contain;">
</div>

<!-- Background Music -->
<audio id="story-audio" src="assets/audio/A_Thousand_Years.mp3" preload="auto" loop></audio>
<audio id="donation-audio" src="assets/audio/Marry_Me_Bella.mp3" preload="auto" loop></audio>
<audio id="invites-audio" src="assets/audio/Turning_Page.mp3" preload="auto" loop></audio>

<script>
  // Improved Carousel with Smoother Transitions
  const images = ["Pose5.jpg", "Pose1.jpg", "Pose3.jpg", "Pose7.jpg","Pose6.jpg","Pose2.jpg"];
  let index = 0;
  let autoPlayInterval = null;
  let isTransitioning = false;

  function updateCarousel() {
    if (isTransitioning) return;
    isTransitioning = true;

    const left = document.getElementById("left-img");
    const center = document.getElementById("center-img");
    const right = document.getElementById("right-img");

    // Smooth fade and scale transition
    center.style.transition = "opacity 0.4s ease, transform 0.4s ease";
    center.style.opacity = "0";
    center.style.transform = "scale(0.92)";

    setTimeout(() => {
      // Update image sources
      left.src = "assets/images/" + images[(index - 1 + images.length) % images.length];
      center.src = "assets/images/" + images[index];
      right.src = "assets/images/" + images[(index + 1) % images.length];

      // Fade back in with smooth transition
      setTimeout(() => {
        center.style.opacity = "1";
        center.style.transform = "scale(1)";

        setTimeout(() => {
          isTransitioning = false;
        }, 400);
      }, 50);
    }, 400);
  }

  // Auto-advance only - no manual controls
  function nextImage() {
    if (!isTransitioning) {
      index = (index + 1) % images.length;
      updateCarousel();
    }
  }

  function startAutoPlay() { autoPlayInterval = setInterval(nextImage, 5000); }
  function stopAutoPlay() { clearInterval(autoPlayInterval); }

  // Dress Code Carousel - Auto-rotating with same logic as main carousel
  const menImages = ["esporte-fino1.jpg", "esporte-fino2.jpg"];
  const ladiesImages = ["ladies-esporte-fino1.jpg", "ladies-esporte-fino2.jpg"];

  let menIndex = 0;
  let ladiesIndex = 0;
  let menTransitioning = false;
  let ladiesTransitioning = false;
  let dressAutoPlayInterval = null;

  function updateDressMen() {
    if (menTransitioning) return;
    menTransitioning = true;

    const img = document.getElementById("dress-men-img");
    img.style.transition = "opacity 0.4s ease, transform 0.4s ease";
    img.style.opacity = "0";
    img.style.transform = "scale(0.92)";

    setTimeout(() => {
      img.src = "assets/images/" + menImages[menIndex];
      setTimeout(() => {
        img.style.opacity = "1";
        img.style.transform = "scale(1)";
        setTimeout(() => {
          menTransitioning = false;
        }, 400);
      }, 50);
    }, 400);
  }

  function updateDressLadies() {
    if (ladiesTransitioning) return;
    ladiesTransitioning = true;

    const img = document.getElementById("dress-ladies-img");
    img.style.transition = "opacity 0.4s ease, transform 0.4s ease";
    img.style.opacity = "0";
    img.style.transform = "scale(0.92)";

    setTimeout(() => {
      img.src = "assets/images/" + ladiesImages[ladiesIndex];
      setTimeout(() => {
        img.style.opacity = "1";
        img.style.transform = "scale(1)";
        setTimeout(() => {
          ladiesTransitioning = false;
        }, 400);
      }, 50);
    }, 400);
  }

  function nextDressImages() {
    if (!menTransitioning && !ladiesTransitioning) {
      menIndex = (menIndex + 1) % menImages.length;
      ladiesIndex = (ladiesIndex + 1) % ladiesImages.length;
      updateDressMen();
      updateDressLadies();
    }
  }

  function startDressAutoPlay() {
    dressAutoPlayInterval = setInterval(nextDressImages, 2500);
  }

  function stopDressAutoPlay() {
    clearInterval(dressAutoPlayInterval);
  }

  // Fullscreen modal for dress code images
  function openDressFullscreen(type) {
    const modal = document.getElementById('dress-fullscreen-modal');
    const img = document.getElementById('dress-fullscreen-img');

    if (type === 'men') {
      img.src = document.getElementById('dress-men-img').src;
    } else {
      img.src = document.getElementById('dress-ladies-img').src;
    }

    modal.style.display = 'flex';
    stopDressAutoPlay();
  }

  function closeDressFullscreen() {
    const modal = document.getElementById('dress-fullscreen-modal');
    modal.style.display = 'none';
    startDressAutoPlay();
  }

  // Toggle Love Letter Overlay - FIXED: Uses fixed positioning
  function toggleLoveLetter() {
    const overlay = document.getElementById('love-letter-overlay');
    const isActive = overlay.classList.contains('active');

    if (isActive) {
      // Close overlay
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    } else {
      // Open overlay
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
      // Scroll overlay to top when opening
      overlay.scrollTop = 0;
    }
  }

  // Toggle Dress Code Overlay - FIXED: Uses fixed positioning
  function toggleDressCode() {
    const overlay = document.getElementById('dress-code-overlay');
    const isActive = overlay.classList.contains('active');

    if (isActive) {
      // Close overlay
      overlay.classList.remove('active');
      document.body.style.overflow = '';
      stopDressAutoPlay();
    } else {
      // Open overlay
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
      // Scroll overlay to top when opening
      overlay.scrollTop = 0;
      startDressAutoPlay();
    }
  }

  // Fullscreen Carousel Functions
  function openFullscreen() {
    const modal = document.getElementById('carousel-fullscreen-modal');
    const fullscreenImg = document.getElementById('fullscreen-carousel-img');
    const centerImg = document.getElementById('center-img');

    fullscreenImg.src = centerImg.src;
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeFullscreen() {
    const modal = document.getElementById('carousel-fullscreen-modal');
    modal.classList.remove('active');
    document.body.style.overflow = '';
  }

  // Close on click outside or escape key
  document.getElementById('carousel-fullscreen-modal').addEventListener('click', function(e) {
    if (e.target === this) closeFullscreen();
  });

  document.getElementById('close-fullscreen').addEventListener('click', closeFullscreen);

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closeFullscreen();
  });

  // Audio Permission Functions
  let audioMuted = false;
  let audioPermissionGiven = false;

  function showAudioPermission() {
    const bubble = document.getElementById('audio-permission');
    bubble.classList.add('active');
  }

  function hideAudioPermission() {
    const bubble = document.getElementById('audio-permission');
    bubble.classList.remove('active');
  }

  function allowAudio() {
    audioPermissionGiven = true;
    audioMuted = false;
    hideAudioPermission();
    enableAudio();
  }

  function muteAudio() {
    audioPermissionGiven = true;
    audioMuted = true;
    hideAudioPermission();
    // Stop all audio
    Object.values(audios).forEach(audio => {
      audio.pause();
      audio.volume = 0;
    });
  }

  // Robust Audio Management - Updated for 4 sections
  const audioSeekTimes = {
    "title-section": 0,
    "carousel-section": 20,
    "donations": 60,
    "venue-info": 33
  };
  const audios = {
    "title-section": document.getElementById('story-audio'),
    "carousel-section": document.getElementById('story-audio'),
    "donations": document.getElementById('donation-audio'),
    "venue-info": document.getElementById('invites-audio')
  };
  let currentPlayingSection = null;
  let debounceTimeout = null;
  let userInteracted = false;
  let fadeIntervals = {};
  const sections = document.querySelectorAll("section");

  // Clear any existing fade interval
  function clearFadeInterval(sectionId) {
    if (fadeIntervals[sectionId]) {
      clearInterval(fadeIntervals[sectionId]);
      delete fadeIntervals[sectionId];
    }
  }

  // Improved fade functions with cleanup
  function fadeOut(audio, sectionId, duration = 700) {
    if (!audio) return;
    clearFadeInterval(sectionId);

    const startVolume = audio.volume;
    const step = startVolume / (duration / 50);

    fadeIntervals[sectionId] = setInterval(() => {
      if (audio.volume > step) {
        audio.volume = Math.max(0, audio.volume - step);
      } else {
        audio.volume = 0;
        audio.pause();
        clearFadeInterval(sectionId);
      }
    }, 50);
  }

  function fadeIn(audio, sectionId, duration = 700, seekTime = null) {
    if (!audio) return;
    clearFadeInterval(sectionId);

    audio.volume = 0;

    // Set seek time before playing
    if (seekTime !== null && !isNaN(seekTime)) {
      try {
        if (audio.readyState >= 2) {
          audio.currentTime = seekTime;
        }
      } catch (e) {
        console.log('Seek not ready yet');
      }
    }

    const playPromise = audio.play();

    if (playPromise !== undefined) {
      playPromise.then(() => {
        // Double check we're still on this section
        if (currentPlayingSection !== sectionId) {
          audio.pause();
          return;
        }

        const step = 1 / (duration / 50);
        fadeIntervals[sectionId] = setInterval(() => {
          if (audio.volume < 1 - step) {
            audio.volume = Math.min(1, audio.volume + step);
          } else {
            audio.volume = 1;
            clearFadeInterval(sectionId);
          }
        }, 50);
      }).catch((error) => {
        console.log('Playback prevented:', error);
      });
    }
  }

  function getActiveSection() {
    let activeSection = null;
    let maxVisibility = 0;

    sections.forEach(section => {
      const rect = section.getBoundingClientRect();
      const viewportHeight = window.innerHeight;

      // Calculate how much of the section is visible
      const visibleTop = Math.max(0, rect.top);
      const visibleBottom = Math.min(viewportHeight, rect.bottom);
      const visibleHeight = Math.max(0, visibleBottom - visibleTop);

      if (visibleHeight > maxVisibility) {
        maxVisibility = visibleHeight;
        activeSection = section.id;
      }
    });

    return activeSection;
  }

  function switchAudio(newSectionId) {
    if (!newSectionId || newSectionId === currentPlayingSection) return;

    // Get unique audios (since some sections share the same audio)
    const previousAudio = currentPlayingSection ? audios[currentPlayingSection] : null;
    const newAudio = audios[newSectionId];

    // If switching to same audio file, just update current section
    if (previousAudio === newAudio && previousAudio !== null) {
      currentPlayingSection = newSectionId;
      return;
    }

    // Pause all audios first to avoid conflicts
    Object.keys(audios).forEach(key => {
      if (audios[key] !== newAudio) {
        const audio = audios[key];
        if (audio && !audio.paused) {
          fadeOut(audio, key, 500);
        }
      }
    });

    // Fade in new audio after brief delay
    if (newAudio) {
      setTimeout(() => {
        // Ensure this audio is not already playing
        if (newAudio.paused || newAudio.volume === 0) {
          fadeIn(newAudio, newSectionId, 800, audioSeekTimes[newSectionId]);
        }
        currentPlayingSection = newSectionId;
      }, 400);
    }
  }

  // Scroll handler with debounce - improved for better section detection
  document.addEventListener("scroll", () => {
    if (audioMuted || !audioPermissionGiven) return;

    // Enable audio interaction on first scroll
    if (!userInteracted) {
      userInteracted = true;
    }

    if (debounceTimeout) clearTimeout(debounceTimeout);
    debounceTimeout = setTimeout(() => {
      const activeSection = getActiveSection();
      if (activeSection && activeSection !== currentPlayingSection) {
        console.log('Switching to section:', activeSection); // Debug log
        switchAudio(activeSection);
      }
    }, 200); // Faster response for audio switching
  }, { passive: true });

  // Enable audio on user interaction
  function enableAudio() {
    if (!userInteracted && !audioMuted && audioPermissionGiven) {
      userInteracted = true;
      const activeSection = getActiveSection();
      if (activeSection) {
        switchAudio(activeSection);
      }
    }
  }

  // Simple fade-in observer
  const sectionObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = '1';
      }
    });
  }, {
    threshold: 0.2
  });

  // Smooth scroll enhancement - ALWAYS center on nearest section with directional bias
  let scrollTimeout;
  let isScrolling = false;
  let lastScrollY = window.scrollY;
  let scrollDirection = 0; // 1 for down, -1 for up

  window.addEventListener('scroll', () => {
    // Detect scroll direction
    const currentScrollY = window.scrollY;
    if (currentScrollY > lastScrollY) {
      scrollDirection = 1; // scrolling down
    } else if (currentScrollY < lastScrollY) {
      scrollDirection = -1; // scrolling up
    }
    lastScrollY = currentScrollY;

    if (!isScrolling) {
      isScrolling = true;
    }

    clearTimeout(scrollTimeout);

    scrollTimeout = setTimeout(() => {
      isScrolling = false;

      // Always snap to nearest section center after scroll stops
      const scrollPosition = window.scrollY + window.innerHeight / 2;
      let closestSection = null;
      let closestDistance = Infinity;

      sections.forEach(section => {
        const rect = section.getBoundingClientRect();
        const sectionCenter = rect.top + window.scrollY + rect.height / 2;
        let distance = Math.abs(scrollPosition - sectionCenter);

        // Add slight bias in scroll direction to make it less sticky
        // If scrolling down and this section is below, reduce distance slightly
        // If scrolling up and this section is above, reduce distance slightly
        const sectionRelativePosition = sectionCenter - scrollPosition;
        if ((scrollDirection > 0 && sectionRelativePosition > 0) ||
            (scrollDirection < 0 && sectionRelativePosition < 0)) {
          distance *= 0.85; // 15% bias towards scroll direction
        }

        // Find closest section with directional bias
        if (distance < closestDistance) {
          closestDistance = distance;
          closestSection = section;
        }
      });

      // ALWAYS center if we found a section
      if (closestSection) {
        const rect = closestSection.getBoundingClientRect();
        const sectionCenter = rect.top + window.scrollY + rect.height / 2;
        const targetScroll = sectionCenter - window.innerHeight / 2;

        // Only scroll if we're not already very close
        if (Math.abs(window.scrollY - targetScroll) > 10) {
          window.scrollTo({
            top: targetScroll,
            behavior: 'smooth'
          });
        }
      }

      scrollDirection = 0; // Reset direction after centering
    }, 100); // Balanced trigger time
  }, { passive: true });

  window.onload = function() {
    updateCarousel();
    startAutoPlay();

    // Observe all sections for fade-in
    sections.forEach((section, index) => {
      sectionObserver.observe(section);
      // Initial state - only hide non-first sections
      if (index > 0) {
        section.style.opacity = '0';
        section.style.transition = 'opacity 0.5s ease';
      }
    });

    // Show audio permission bubble after 1 second
    setTimeout(showAudioPermission, 1000);
  };

  // Countdown
  const weddingDate = new Date("2025-12-27T16:00:00").getTime();
  function updateCountdown() {
    const now = new Date().getTime();
    const distance = weddingDate - now;
    if (distance <= 0) {
      document.querySelector(".countdown-card").innerHTML = "<b>It's wedding time!</b>";
      return;
    }
    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    document.getElementById("days").innerText = days;
    document.getElementById("hours").innerText = hours;
  }
  setInterval(updateCountdown, 1000);
  updateCountdown();
</script>
</body>
</html>
